---
name: CI/CD
on:
  push:
  workflow_dispatch:
  repository_dispatch:
    types: [trigger]

jobs:
  # lint:
  #   uses: ./.github/workflows/lint.yml
  #   secrets:
  #     github-token: ${{ secrets.ADMIN_GITHUB_TOKEN }}

  test2:
    runs-on: ubuntu-20.04
    steps:
      - run: exit 1

  determine-conclusion:
    needs: [test2]
    if: always()
    uses: ./.github/workflows/conclusion.yml
    secrets:
      github-token: ${{ secrets.ADMIN_GITHUB_TOKEN }}

  post-to-slack:
    needs: [determine-conclusion]
    if: always()
    uses: ./.github/workflows/notify.yml
    with:
      workflow-conclusion: ${{ needs.determine-conclusion.outputs.conclusion }}
    secrets:
      slack-webhook: ${{ secrets.SLACK_GITHUB_WEBHOOK_URL }}
